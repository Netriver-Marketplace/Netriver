<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Netriver</title>
    <link rel="stylesheet" href="css/style.css">
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <button class="theme-toggle">ðŸŒ“</button>

    <nav>
        <div class="container nav-container">
            <a href="/" class="logo">Netriver</a>
            <button class="mobile-menu-btn">â˜°</button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="products.html">Products</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="cart.html">Cart <span class="cart-count">0</span></a></li>
                <li><a href="login.html">Login</a></li>
                <li><a href="register.html">Register</a></li>
            </ul>
        </div>
    </nav>

    <section class="page-header">
        <div class="container">
            <h1>All Products</h1>
            <p>Browse our wide selection of quality products</p>
        </div>
    </section>

    <section class="search-filters">
        <div class="container">
            <div class="filter-container">
                <div class="filter-group">
                    <label for="search-input">Search Products:</label>
                    <input type="text" id="search-input" placeholder="Search by name or description">
                </div>
                <div class="filter-group">
                    <label for="category-select">Category:</label>
                    <select id="category-select">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="min-price">Min Price (â‚¦):</label>
                    <input type="number" id="min-price" placeholder="0" min="0">
                </div>
                <div class="filter-group">
                    <label for="max-price">Max Price (â‚¦):</label>
                    <input type="number" id="max-price" placeholder="Max" min="0">
                </div>
                <button id="search-button" class="cta-button">Search</button>
            </div>
        </div>
    </section>

    <section class="products-section">
        <div class="container">
            <div class="product-grid" id="product-grid">
                <div class="spinner"></div>
            </div>
            
            <div class="pagination" id="pagination">
                <!-- Pagination will be dynamically added -->
            </div>
        </div>
    </section>

    <footer>
        <div class="container footer-content">
            <div class="footer-section">
                <h3>Netriver</h3>
                <p>Your trusted Nigerian marketplace</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <a href="products.html">Products</a>
                <a href="about.html">About Us</a>
                <a href="contact.html">Contact</a>
            </div>
            <div class="footer-section">
                <h3>Seller Zone</h3>
                <a href="register.html">Register as Seller</a>
                <a href="login.html">Seller Login</a>
            </div>
            <div class="footer-section">
                <h3>Contact Info</h3>
                <p>Email: admin@netriver.ng</p>
                <p>Phone: +234 800 000 0000</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        // Load products and categories on page load
        document.addEventListener('DOMContentLoaded', async () => {
            const productGrid = document.getElementById('product-grid');
            const categorySelect = document.getElementById('category-select');

            // Load categories
            try {
                const response = await fetch('/api/products/categories/list');
                const data = await response.json();
                
                if (data.categories) {
                    data.categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categorySelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Failed to load categories:', error);
            }

            // Load products
            if (productGrid) {
                try {
                    const response = await fetch('/api/products?limit=20');
                    const data = await response.json();
                    
                    productGrid.innerHTML = '';
                    
                    if (data.products.length === 0) {
                        productGrid.innerHTML = '<p class="no-products">No products found</p>';
                        return;
                    }

                    data.products.forEach(product => {
                        const card = document.createElement('div');
                        card.className = 'product-card';
                        const imageUrl = product.image_url || 'https://via.placeholder.com/300x200?text=No+Image';
                        
                        card.innerHTML = `
                            <a href="/product/${product.id}" style="text-decoration: none;">
                                <img src="${imageUrl}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/300x200?text=Image+Not+Available'">
                                <div class="product-info">
                                    <h3 class="product-name">${product.name}</h3>
                                    <p class="product-price">â‚¦${parseFloat(product.price).toLocaleString('en-NG', {minimumFractionDigits: 2})}</p>
                                    <p class="product-category">${product.category}</p>
                                    <p class="product-seller">Sold by: ${product.seller_name} (${product.seller_state})</p>
                                </div>
                            </a>
                            <button class="add-to-cart-btn" onclick="addToCart(${product.id})">
                                Add to Cart
                            </button>
                        `;
                        productGrid.appendChild(card);
                    });

                    // Add pagination
                    const pagination = document.getElementById('pagination');
                    if (pagination && data.pagination) {
                        const { page, totalPages } = data.pagination;
                        if (totalPages > 1) {
                            let paginationHTML = '<div class="pagination-controls">';
                            
                            if (page > 1) {
                                paginationHTML += `<button onclick="loadPage(${page - 1})" class="pagination-btn">Previous</button>`;
                            }
                            
                            for (let i = 1; i <= totalPages; i++) {
                                if (i === page) {
                                    paginationHTML += `<button class="pagination-btn active">${i}</button>`;
                                } else {
                                    paginationHTML += `<button onclick="loadPage(${i})" class="pagination-btn">${i}</button>`;
                                }
                            }
                            
                            if (page < totalPages) {
                                paginationHTML += `<button onclick="loadPage(${page + 1})" class="pagination-btn">Next</button>`;
                            }
                            
                            paginationHTML += '</div>';
                            pagination.innerHTML = paginationHTML;
                        }
                    }
                } catch (error) {
                    productGrid.innerHTML = '<p class="error">Failed to load products</p>';
                }
            }
        });

        // Load specific page
        async function loadPage(page) {
            const productGrid = document.getElementById('product-grid');
            const searchInput = document.getElementById('search-input');
            const categorySelect = document.getElementById('category-select');
            const minPriceInput = document.getElementById('min-price');
            const maxPriceInput = document.getElementById('max-price');

            const params = new URLSearchParams({
                page: page,
                limit: 20
            });

            if (searchInput?.value) {
                params.append('search', searchInput.value);
            }

            if (categorySelect?.value) {
                params.append('category', categorySelect.value);
            }

            if (minPriceInput?.value) {
                params.append('minPrice', minPriceInput.value);
            }

            if (maxPriceInput?.value) {
                params.append('maxPrice', maxPriceInput.value);
            }

            try {
                const response = await fetch(`/api/products?${params.toString()}`);
                const data = await response.json();
                
                productGrid.innerHTML = '';
                
                if (data.products.length === 0) {
                    productGrid.innerHTML = '<p class="no-products">No products found</p>';
                    return;
                }

                data.products.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    const imageUrl = product.image_url || 'https://via.placeholder.com/300x200?text=No+Image';
                    
                    card.innerHTML = `
                        <a href="/product/${product.id}" style="text-decoration: none;">
                            <img src="${imageUrl}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/300x200?text=Image+Not+Available'">
                            <div class="product-info">
                                <h3 class="product-name">${product.name}</h3>
                                <p class="product-price">â‚¦${parseFloat(product.price).toLocaleString('en-NG', {minimumFractionDigits: 2})}</p>
                                <p class="product-category">${product.category}</p>
                                <p class="product-seller">Sold by: ${product.seller_name} (${product.seller_state})</p>
                            </div>
                        </a>
                        <button class="add-to-cart-btn" onclick="addToCart(${product.id})">
                            Add to Cart
                        </button>
                    `;
                    productGrid.appendChild(card);
                });

                // Update pagination
                const pagination = document.getElementById('pagination');
                if (pagination && data.pagination) {
                    const { page, totalPages } = data.pagination;
                    if (totalPages > 1) {
                        let paginationHTML = '<div class="pagination-controls">';
                        
                        if (page > 1) {
                            paginationHTML += `<button onclick="loadPage(${page - 1})" class="pagination-btn">Previous</button>`;
                        }
                        
                        for (let i = 1; i <= totalPages; i++) {
                            if (i === page) {
                                paginationHTML += `<button class="pagination-btn active">${i}</button>`;
                            } else {
                                paginationHTML += `<button onclick="loadPage(${i})" class="pagination-btn">${i}</button>`;
                            }
                        }
                        
                        if (page < totalPages) {
                            paginationHTML += `<button onclick="loadPage(${page + 1})" class="pagination-btn">Next</button>`;
                        }
                        
                        paginationHTML += '</div>';
                        pagination.innerHTML = paginationHTML;
                    }
                }

                // Scroll to top of products
                productGrid.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                productGrid.innerHTML = '<p class="error">Failed to load products</p>';
            }
        }
    </script>
</body>
</html>